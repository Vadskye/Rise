%Set the spacing of lists
\newenvironment{enumerate*}
{\begin{enumerate}
  \setlength{\leftmargin}{0em}
  \setlength{\topsep}{1pt}
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}}
{\end{enumerate}}

\ExplSyntaxOn

%Define a custom table that uses that coloring
\newenvironment{dtable}
{\begin{table}[htb!]
    \small
    \rowcolors{1}{white}{tbrown}
}
{\end{table}}
%Plus a custom table that takes up two columns
\newenvironment{dtable*}
{\begin{table*}[htb!]
  \small
  \rowcolors{1}{white}{tbrown}}
{\end{table*}}
%And one more for two-column tables that need fewer restrictions
\newenvironment{dtable!*}
{\begin{table*}[htb!]
    \small
    \rowcolors{1}{white}{tbrown}
}{
    \end{table*}
}

% small text for the feats table
\newenvironment{longtablewrapper}
{
    \onecolumn
    \small
    \rowcolors{1}{white}{tbrown}
    \renewcommand*{\arraystretch}{1.2}
    \setlength\LTleft{0pt}
    \setlength\LTright{0pt}
}
{\twocolumn}

%A list for normal spells
\newenvironment{spelllist}
{\begin{description}[nosep,font=\normalfont,leftmargin=2.25em,style=nextline,itemindent=-1em]}
{\end{description}}

\DeclareDocumentEnvironment{fakehang}{}
{
    \setlength{\parindent}{2em}
    \everypar{\hangindent=1em}
}
{
    \par
}

\DeclareDocumentEnvironment{spellheader}{s}
{
    %\IfBooleanF{#1}{\spellline}
}
{
    %\IfBooleanF{#1}{\spellline}
}

\definecolor{cosmiclatte}{rgb}{1.0, 0.97, 0.91}

\newmdenv[
    backgroundcolor=cosmiclatte,
    leftline=true,
    topline=true,
    rightline=true,
    bottomline=true,
    roundcorner=4pt,
    skipabove=0.5em,
    skipbelow=0.5em,
    leftmargin=-1em,
    innerleftmargin=0.25em,
    innerrightmargin=0.5em,
    innertopmargin=0.5em,
    innerbottommargin=0.25em,
]{freeabilitymdframed}
\DeclareDocumentEnvironment{freeability}{s o m o}
{
    \begin{freeabilitymdframed}
    \RaggedRight
    \IfBooleanF{#1}{
        \lowercase{\hypertargetraised{ability:#3}{}}
        \hypertargetraised{ability:#3}{}
        \lowercase{\hypertargetraised{spell:#3}{}}
        \hypertargetraised{spell:#3}{}
        \lowercase{\hypertargetraised{maneuver:#3}{}}
        \hypertargetraised{maneuver:#3}{}
    }
    \spelltwocol{
        {\normalsize \textbf{#3}}
        \IfValueTF{#2}{~--~#2}{}
    }{
        \IfValueTF{#4}{#4}{}
    }
}
{
    \end{freeabilitymdframed}
}

\newmdenv[
    backgroundcolor=cosmiclatte,
    leftline=true,
    topline=true,
    rightline=true,
    bottomline=true,
    roundcorner=4pt,
    skipabove=0.5em,
    skipbelow=0.5em,
    leftmargin=-0.5em,
    innerleftmargin=0.25em,
    innerrightmargin=0.5em,
    innertopmargin=0.5em,
    innerbottommargin=0.25em,
]{durationabilitymdframed}
\DeclareDocumentEnvironment{durationability}{s o m o}
{
    \begin{durationabilitymdframed}
    \RaggedRight
    \IfBooleanF{#1}{
        \lowercase{\hypertargetraised{ability:#3}{}}
        \hypertargetraised{ability:#3}{}
        \lowercase{\hypertargetraised{spell:#3}{}}
        \hypertargetraised{spell:#3}{}
        \lowercase{\hypertargetraised{maneuver:#3}{}}
        \hypertargetraised{maneuver:#3}{}
    }
    \spelltwocol{
        {\normalsize \textbf{#3}}
        \IfValueTF{#2}{~--~#2}{}
    }{
        \IfValueTF{#4}{#4}{}
    }
}
{
    \end{durationabilitymdframed}
}

\newmdenv[
    backgroundcolor=brown!8,
    leftline=true,
    topline=true,
    rightline=true,
    bottomline=true,
    roundcorner=4pt,
    skipabove=0.5em,
    skipbelow=0.5em,
    leftmargin=-0.5em,
    innerleftmargin=0.25em,
    innerrightmargin=0.5em,
    innertopmargin=0.5em,
    innerbottommargin=0.25em,
]{attuneabilitymdframed}
\DeclareDocumentEnvironment{attuneability}{s o m o}
{
    \begin{attuneabilitymdframed}
    \RaggedRight
    \IfBooleanF{#1}{
        \lowercase{\hypertargetraised{ability:#3}{}}
        \hypertargetraised{ability:#3}{}
        \lowercase{\hypertargetraised{spell:#3}{}}
        \hypertargetraised{spell:#3}{}
        \lowercase{\hypertargetraised{maneuver:#3}{}}
        \hypertargetraised{maneuver:#3}{}
    }
    \spelltwocol{
        {\normalsize \textbf{#3}}
        \IfValueTF{#2}{~--~#2}{}
    }{
        \IfValueTF{#4}{#4}{}
    }
}
{
    \end{attuneabilitymdframed}
}

\newmdenv[
    backgroundcolor=MintCream,
    leftline=true,
    topline=true,
    rightline=true,
    bottomline=true,
    roundcorner=4pt,
    skipabove=0.5em,
    skipbelow=0.5em,
    leftmargin=-0.5em,
    innerleftmargin=0.25em,
    innerrightmargin=0.5em,
    innertopmargin=0.5em,
    innerbottommargin=0.25em,
]{instantabilitymdframed}
\DeclareDocumentEnvironment{instantability}{s o m}
{
    \begin{instantabilitymdframed}
    \RaggedRight
    \IfBooleanF{#1}{
        \lowercase{\hypertargetraised{ability:#3}{}}
        \hypertargetraised{ability:#3}{}
        \lowercase{\hypertargetraised{spell:#3}{}}
        \hypertargetraised{spell:#3}{}
        \lowercase{\hypertargetraised{maneuver:#3}{}}
        \hypertargetraised{maneuver:#3}{}
    }
    \spelltwocol{
        {\normalsize \textbf{#3}}
        \IfValueTF{#2}{~--~#2}{}
    }{
        Instant
    }
}
{
    \end{instantabilitymdframed}
}

\DeclareDocumentEnvironment{dtabularx}{m m}
{
    \tabularx{#1}{#2}%
}
{
    \endtabularx
}
\surroundwithmdframed{dtabularx}

\DeclareDocumentEnvironment{spellsection}{o m o}
{
    \begin{thesamepage}
    \setlength{\multicolsep}{0pt}
    \begin{multicols}{2}
        \IfValueTF{#1}
        {
            \lowercase{\hypertarget{spell:#1~#2}{}}\label{spell:#1~#2}
            \hypertarget{spell:#1~#2}
                {\subsubsection{#2,~#1}}
        }
        {
            \lowercase{\hypertarget{spell:#2}{}}\label{spell:#2}
            \hypertarget{spell:#2}
                {\subsection{#2}}
        }
        \IfValueTF{#3}
        {
            \columnbreak
            \begin{flushright}
                \large\textbf{\nth{#3}~Level}
            \end{flushright}
        }
        {
            \columnbreak
            \begin{flushright}
            \end{flushright}
        }
    \end{multicols}
}
{
    \end{thesamepage}
}

\DeclareDocumentEnvironment{thesamepage}{}
{
    \par\nobreak\vfil\penalty0\vfilneg
    \vtop{}
}
{
    \par\xdef\tpd{\the\prevdepth}
    \prevdepth=\tpd
}

\DeclareDocumentEnvironment{feat}{m m}
{
    \subsection[#1~#2]{
        \protect
        \hypertarget{feat:#1}{
            \protect
            \hyperlink{ft:#1}{#1~[#2]}
        }
    }
    \label{feat:#1}
}
{}

\DeclareDocumentEnvironment{monsubsection}{m o m o}
{
    \setlength\multicolsep{0pt}
    \begin{multicols}{2}
        \IfValueTF{#2}
        {
            \lowercase{\hypertarget{mon:#2~#1}{}}
            \label{mon:#2~#1}
            \hypertarget{mon:#2~#1}
                {\subsection*{#1,~#2}}
        }
        {
            \lowercase{\hypertarget{mon:#1}{}}
            \label{mon:#1}
            \hypertarget{mon:#1}
                {\subsection*{#1}}
        }

        \columnbreak
        \begin{flushright}
            \large\textbf{Level~#3}
            \IfValueTF{#4}
            {
                \textbf{~[CR~#4]}
            }
            {
                \textbf{~[CR~1]}
            }
        \end{flushright}
    \end{multicols}
}
{
}

\DeclareDocumentEnvironment{monsubsubsection}{m o m o}
{
    \setlength\multicolsep{0pt}
    \begin{multicols}{2}
        \IfValueTF{#2}
        {
            \lowercase{\hypertarget{mon:#2~#1}{}}
            \label{mon:#2~#1}
            \hypertarget{mon:#2~#1}
                {\subsubsection{#1,~#2}}
        }
        {
            \lowercase{\hypertarget{mon:#1}{}}
            \label{mon:#1}
            \hypertarget{mon:#1}
                {\subsubsection*{#1}}
        }

        \columnbreak
        \begin{flushright}
            \textbf{Level~#3}
            \IfValueTF{#4}
            {
                \textbf{~[CR~#4]}
            }
            {
                \textbf{~[CR~1]}
            }
        \end{flushright}
    \end{multicols}
}
{
}


\DeclareDocumentEnvironment{raggeditemize}{}
{\begin{itemize}\RaggedRight}
{\end{itemize}}

\definecolor{floralwhite}{rgb}{1.0, 0.98, 0.94}
\newmdenv[
    backgroundcolor=floralwhite,
    leftline=false,
    topline=true,
    rightline=false,
    bottomline=true,
    roundcorner=4pt,
    skipabove=0.5em,
    skipbelow=0.5em,
    leftmargin=-0.5em,
    innerleftmargin=0.25em,
    innerrightmargin=0.5em,
    innertopmargin=0.5em,
    innerbottommargin=0.25em,
]{descriptionmdframed}
\DeclareDocumentEnvironment{description}{}
{
    \begin{descriptionmdframed}
}
{
    \end{descriptionmdframed}
}

\ExplSyntaxOff
