\newcommand{\lcaption}[1]{\caption{#1}\label{cap:#1}}

\newcommand{\pref}[1]{page \pageref{#1}}
\newcommand{\tref}[1]{Table \ref{cap:#1}: #1 (\pref{cap:#1})}
\newcommand{\trefnp}[1]{Table \ref{cap:#1}: #1}

\newcommand{\minus}{\texttt{-{}}}
\newcommand{\plus}{\texttt{+}}    %Use a smaller positive marker for use directly adjacent to numbers
\newcommand{\add}{\texttt{+}\xspace}    %Use a smaller plus sign
\newcommand{\sub}{\texttt{-}\xspace}
\newcommand{\mult}{x}
\newcommand{\x}{x\xspace}
%NOTED BUG: Spell names with mixed capitalization (Dispel magic) will not work properly.
\newcommand{\sphere}[1]{\emph{\mbox{\hyperlink{spell:#1}{#1}}}}    %Italicize mystic spheres
\newcommand{\spell}[1]{\emph{\mbox{\hyperlink{spell:#1}{#1}}}}    %Italicize spells
\newcommand{\spellindirect}[2]{\emph{\hyperlink{spell:#1}{#2}}}
\newcommand{\ritual}[1]{\emph{#1}}    %Italicize spells
\newcommand{\subcf}[1]{\parhead{#1}}    %Bold sub-class-feature headers
\newcommand{\subsk}[1]{\par \emph{#1}:}    %Italicize sub-skill headers

\newcommand{\subparhead}[1]{\par\emph{#1}:}
\newcommand{\tb}[1]{\textbf{#1}}    %Bold the header of tables
\newcommand{\tdash}{\hskip 0.1em---\xspace}    %A null entry in a table
\newcommand{\ccol}{\centering\arraybackslash}    %Center columns
\newcommand{\lcol}{\raggedright\arraybackslash}
\newcommand{\rcol}{\raggedleft\arraybackslash}

\newcommand{\fn}[1]{\textsuperscript{#1}}
\newcommand{\magicitem}[1]{\emph{#1}}    %For the names of items
\newcommand{\mitem}[1]{\emph{#1}}

\newcommand{\tind}{\hspace{1em}}

\newcommand{\spelldesc}[1]{\par\noindent \textit{#1}}
\newcommand{\spelltwocol}[2]{\spelltabularcompressed #1 & #2\end{tabularx}}

\newcommand{\rngpers}{Personal}
\newcommand{\rngtouch}{Touch}
\newcommand{\rngshort}{Short \reminder{30 ft.}\xspace}
\newcommand{\rngmed}{Medium \reminder{60 ft.}\xspace}
\newcommand{\rnglong}{Long \reminder{120 ft.}\xspace}
\newcommand{\rngdist}{Distant \reminder{240 ft.}\xspace}
\newcommand{\rngext}{Extreme \reminder{480 ft.}\xspace}

\newcommand{\areatiny}{Tiny \reminder{5 ft.}\xspace}
\newcommand{\areasmall}{Small \reminder{15 ft.}\xspace}
\newcommand{\areamed}{Medium \reminder{30 ft.}\xspace}
\newcommand{\arealarge}{Large \reminder{60 ft.}\xspace}
\newcommand{\areahuge}{Huge \reminder{120 ft.}\xspace}
\newcommand{\areagarg}{Gargantuan \reminder{240 ft.}\xspace}

\newcommand{\confusionexplanation}{A confused creature cannot take actions normally. If it is attacked, it automatically attacks a random attacker. Otherwise, at the beginning of each round, it randomly decides to take one of four actions that round: babble incoherently, flee from the caster as if panicked, attack the nearest creature, or act normally. A confused character who can't carry out the indicated action does nothing but babble incoherently.\xspace}

\newcommand{\featpre}{\parhead{Prerequisite} }
\newcommand{\featpres}{\parhead{Prerequisites} }
%featref no target
\newcommand{\featpref}[1]{\pageref{feat:#1}}
\newcommand{\mitempref}[1]{\pageref{item:#1}}
\newcommand{\featpcref}[1]{#1, page \pageref{feat:#1}}

\newcommand{\skill}[2]{\section{#1 (#2)}\label{#1}}

\newcommand{\reminder}[1]{\textcolor{darkgray}{\textit{(#1)}}}

%\newcommand{\vulnerableexplanation}{A vulnerable creature takes a \minus2 penalty to attacks, defenses, and checks.\xspace}
%\newcommand{\vulneffect}{\minus2 to attacks, defenses, and checks\xspace}

\newcommand{\blinded}{\glossterm{blinded}\xspace}
\newcommand{\charmed}{\glossterm{charmed}\xspace}
\newcommand{\confused}{\glossterm{confused}\xspace}
\newcommand{\defenseless}{\glossterm{defenseless}\xspace}
\newcommand{\disoriented}{\glossterm{disoriented}\xspace}
\newcommand{\dominated}{\glossterm{dominated}\xspace}
\newcommand{\fascinated}{\glossterm{fascinated}\xspace}
\newcommand{\frightened}{\glossterm{frightened}\xspace}
\newcommand{\dazed}{\glossterm{dazed}\xspace}
\newcommand{\dazzled}{\glossterm{dazzled}\xspace}
\newcommand{\deafened}{\glossterm{deafened}\xspace}
\newcommand{\grappled}{\glossterm{grappled}\xspace}
\newcommand{\goaded}{\glossterm{goaded}\xspace}
\newcommand{\helpless}{\glossterm{helpless}\xspace}
\newcommand{\ignited}{\glossterm{ignited}\xspace}
\newcommand{\nauseated}{\glossterm{nauseated}\xspace}
\newcommand{\panicked}{\glossterm{panicked}\xspace}
\newcommand{\paralyzed}{\glossterm{paralyzed}\xspace}
\newcommand{\petrified}{\glossterm{petrified}\xspace}
\newcommand{\prone}{\glossterm{prone}\xspace}
\newcommand{\shaken}{\glossterm{shaken}\xspace}
\newcommand{\sickened}{\glossterm{sickened}\xspace}
\newcommand{\slowed}{\glossterm{slowed}\xspace}
\newcommand{\staggered}{\glossterm{staggered}\xspace}
\newcommand{\stunned}{\glossterm{stunned}\xspace}
\newcommand{\taunted}{\glossterm{taunted}\xspace}
\newcommand{\unaware}{\glossterm{unaware}\xspace}

\newcommand{\concealment}{concealment\xspace}

\newcommand{\spelltablecolumns}{>{\lcol}X l}
\newcommand{\spelllevelschool}[2]{\spelllvl{#1} & #2 \\}
\newcommand{\spelllevelnew}[3]{\tb{\nth{#1} level} #2 & #3 \\}

\newcommand{\dismissable}{}

\ExplSyntaxOn

\DeclareDocumentCommand{\parhead}{s m o}
{
    \vspace{0.25em}
    \par \noindent
    \IfNoValueTF{#3}
    {\textbf{#2}:}
    {\textbf{#2}~[#3]:}\xspace
}

\DeclareDocumentCommand{\rank}{m}
{
    \par \noindent
    \textit{Rank~#1}:
}

\DeclareDocumentCommand{\featlevel}{m}
{
    \par \noindent
    \textit{Level~#1}:
}

\DeclareDocumentCommand{\rankline}{}
{
    \par
    \vspace{-0.5em}
    \noindent
    \hrulefill
    \par\noindent
}

% If #1 = #2
%     print #3.
% Elseif #4 is provided
%     print #4
\DeclareDocumentCommand{\ifstr}{m m m o}
{
    \ifnum 0=\pdfstrcmp{#1}{#2}
        #3
    \else
        \IfValueT{#4}{#4}
    \fi
}

% args:
%   pre-spell header spell name, spell name modifier (Greater, etc.)
\DeclareDocumentCommand{\spellhead}{o m o}
{
    \IfValueTF{#1}
    {\item[#1]}
    {\item}
    \textbf{
        \IfValueTF{#3}
        {
            \hyperlink{spell:#3~#2}{#2,~#3}
            %\pageref{spell:#3~#2}
        }
        {
            \hyperlink{spell:#2}{#2}
            %\pageref{spell:#2}
        }
    }:
}

% args:
%   pre-spell header spell name, spell name modifier (Greater, etc.)
\DeclareDocumentCommand{\maneuverhead}{o m o}
{
    \IfValueTF{#1}
    {\item[#1]}
    {\item}
    \textbf{
        \IfValueTF{#3}
        {
            \hyperlink{maneuver:#3~#2}{#2,~#3}
            \hypertarget{maneuverlist:#3~#2}
        }
        {
            \hyperlink{maneuver:#2}{#2}
            \hypertarget{maneuverlist:#2}
        }
    }:
}

\DeclareDocumentCommand{\imath}{m}
{
    %\pgfmathparse{int(floor(#1))}\pgfmathresult
    \pgfmathsetmacro{\TempVar}{int(floor(#1))}
    \TempVar
}

\DeclareDocumentCommand{\imathparse}{m}
{
    \pgfmathsetmacro{\TempVar}{int(floor(#1))}
}

\DeclareDocumentCommand{\imathresult}{}
{
    \TempVar
}

\DeclareDocumentCommand{\spelltabular}{}
{
    \par\noindent
    \begin{tabularx}{\columnwidth}{>{\lcol}X l}
}

\DeclareDocumentCommand{\spelltabularcompressed}{}
{
    \renewcommand{\arraystretch}{0.5}
    \par\noindent
    \begin{tabularx}{\linewidth}{@{}~>{\lcol}X~l~@{}}
}

% args:
%   class name
%   level, if any
%   ability name
%   ability type (Ex, Su, etc.), if any
\DeclareDocumentCommand{\cf}{s m o m o}
{
    \IfValueTF{#3}
    {
        \IfValueTF{#5}
        { \subsubsection{Rank~#3~--~#4~(#5)} }
        { \subsubsection{Rank~#3~--~#4} }
    }
    {
        \IfValueTF{#5}
        { \subsubsection{#4~(#5)} }
        { \subsubsection{#4} }
    }
    \IfBooleanF{#1}
    {
        \label{#2:#4}
    }
}

% feat level
% args:
%   level
%   name
%   ability type, if any
\DeclareDocumentCommand{\ff}{o m o}
{
    \IfValueTF{#1}
    {
        \IfValueTF{#3}
        { \nth{#1}~--~\textbf{#2}~(#3): }
        { \nth{#1}~--~\textbf{#2}: }
    }
    {
        \IfValueTF{#3}
        { \parhead{#2~(#3)} }
        { \parhead{#2} }
    }
}

\DeclareDocumentCommand{\itemhead}{s m}
{
    \item
    \IfValueTF{#1}
    {
        \textit{#2}
    }
    {
        \textbf{#2}
    }
}

\DeclareDocumentCommand{\featref}{s m}
{
    \hyperlink{feat:#2}{#2}
    \IfBooleanF{#1}
    {
        \hypertarget{ft:#2}{}
    }
}

% args:
%   #1: reference name of term, if different from display name
%   #2: display name of term
\DeclareDocumentCommand{\glossterm}{o m}
{
    \IfValueTF{#1}
    {
        % Enable this to test for missing glossary definitions
        % \pref{#1}
        % Enable this to test for unnecessary glossary entries
        % \label{#1}

        % TODO: remove \mbox before making major releases;
        % it fixes bizarre page break errors but makes text uglier
        \hyperlink{gloss:#1}{\textbf{\mbox{#2}}}
    }
    {
        % Enable this to test for missing glossary definitions
        % \pref{#2}
        % Enable this to test for unnecessary glossary entries
        % \label{#2}

        \hyperlink{gloss:#2}{\textbf{\mbox{#2}}}
    }
}

% args:
%   #1: name of term
%   #2: alternate name of term, only used for labels/targets
\DeclareDocumentCommand{\glossdef}{m o}
{
    \IfValueT{#2}
    {
        % Enable this to test for missing glossary definitions
        % \label{#2}\label{#2s}
        % Enable this to test for unnecessary glossary entries
        % \pref{#2}

        \hypertarget{gloss:#2}{}
        \hypertarget{gloss:#2s}{}
    }
    % Enable this to test for missing glossary definitions
    % \label{#1}\label{#1s}
    % Enable this to test for unnecessary glossary entries
    % \pref{#1}

    \hypertarget{gloss:#1}{}
    \hypertarget{gloss:#1s}{}
    \parhead{#1}
}

\DeclareDocumentCommand{\pcref}{o m}
{
    \IfValueTF{#1}
    {
        #2,~page~\pageref{#1}
    }
    {
        #2,~page~\pageref{#2}
    }
}

\DeclareDocumentCommand{\labeltext}{m}
{
    #1\label{#1}
}

\DeclareDocumentCommand{\hit}{}
{
    \subparhead{Hit}\xspace
}

\DeclareDocumentCommand{\glance}{}
{
    \subparhead{Glancing~Blow}\xspace
}


\DeclareDocumentCommand{\crit}{}
{
    \subparhead{Critical~Hit}\xspace
}

\DeclareDocumentCommand{\miss}{}
{
    \subparhead{Miss}\xspace
}

\DeclareDocumentCommand{\tableheaderrule}{}
{
    \vspace{-0.25em}
    \\
    \bottomrule
}

\DeclareDocumentCommand{\targetrule}{s}{
    \par
    \vspace{-0.5em}
    \noindent
    \hrulefill
    \par\noindent
}

\DeclareDocumentCommand{\target}{m}{
    \par\noindent
    Target:~#1
    \targetrule*
}

\DeclareDocumentCommand{\targets}{m}{
    \par\noindent
    Targets:~#1
    \targetrule
}

\DeclareDocumentCommand{\monsep}{}{
    \hspace{0.8em}
}

\ExplSyntaxOff

\newcommand{\classbasics}[1]{\par\noindent\textbf{#1}:}

\newcommand{\pari}{\par\noindent}
